<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FlashBuyX</title>
    <style>
        /* RESET Y BASE */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: sans-serif; background: #f9f9f9; color: #333; }

        /* HEADER */
        header {
            background: #ffffff;
            display: flex;
            align-items: center;
            padding: 1rem 2rem;
            gap: 1rem;
            flex-wrap: wrap; /* Allows items to wrap on smaller screens */
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* Logo - Default (Desktop) */
        header img {
            max-height: 100px;
            height: auto;
            width: auto;
            cursor: pointer;
        }

        /* Navegación - Default (Desktop) */
        nav { display: flex; gap: 1rem; }
        nav a {
            color: #000000;
            text-decoration: none;
            font-weight: 600;
            padding: 0.5rem 0.75rem;
            cursor: pointer;
        }
        nav a:hover {
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
        }

        /* Barra de búsqueda - Default (Desktop) */
        .search-bar {
            position: relative;
            flex: 1 1 500px;
            max-width: 600px;
            display: flex;
            align-items: center; /* Align items vertically */
        }
        .search-bar input {
            flex: 1;
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            font-size: 1rem;
        }
        /* Desktop search button */
        #desktopSearchBtn {
            padding: 0.5rem 1.5rem;
            background: #ff0101;
            color: #fff;
            border: none;
            border-radius: 0 4px 4px 0;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            display: block; /* Show on desktop */
        }
        #desktopSearchBtn:hover {
            background: #b30000;
        }
        /* Mobile search icon inside the bar */
        #mobileSearchIconInBar {
            display: none; /* Hidden on desktop */
        }

        /* Iconos derecha - Default (Desktop) */
        .header-right {
            /* margin-left: auto; REMOVED THIS LINE */
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* Base para botones redondeados (Carrito y Cuenta/Usuario) */
        .btn-rounded {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 0, 0, 0.89);
            color: #000000;
            font-weight: bold;
            border: none;
            padding: 0.4rem 1rem;
            border-radius: 999px;
            cursor: pointer;
            font-size: 0.9rem;
            text-decoration: none;
            white-space: nowrap;
        }
        .btn-rounded:hover {
            background: #cc0000;
            color: white;
        }
        .btn-rounded svg {
            width: 20px;
            height: 20px;
            fill: #000000;
        }
        .btn-rounded:hover svg {
            fill: white;
        }

        /* --- MENÚ HAMBURGUESA Y BÚSQUEDA MÓVIL --- */
        .hamburger-menu-btn {
            display: none; /* Hidden by default on desktop */
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
        }
        .hamburger-menu-btn svg {
            width: 28px; /* Larger icon for mobile */
            height: 28px;
            fill: #333;
        }

        /* Media Queries for Mobile Design */
        @media (max-width: 768px) {
            header {
                padding: 0.8rem 1rem; /* Adjust padding for smaller screens */
                flex-wrap: nowrap; /* Prevent wrapping in header on mobile */
                justify-content: space-between; /* Distribute items */
                gap: 0.5rem; /* Reduce gap between items */
            }

            /* Hide logo on mobile to prioritize hamburger and search */
            header img {
                display: none;
            }

            /* Show hamburger menu button */
            .hamburger-menu-btn {
                display: block;
                order: 1; /* Place it first */
            }

            /* Hide main navigation and move to off-canvas */
            nav {
                display: none; /* Hide on mobile by default */
                flex-direction: column;
                position: fixed;
                top: 0;
                left: -100%; /* Off-screen */
                width: 250px;
                height: 100%;
                background-color: #fff;
                box-shadow: 2px 0 5px rgba(0,0,0,0.1);
                padding-top: 60px; /* Space for fixed header */
                z-index: 999;
                transition: left 0.3s ease-in-out;
            }
            nav.active { /* Class to show the menu */
                left: 0;
            }
            nav a {
                padding: 1rem 1.5rem;
                border-bottom: 1px solid #eee;
                font-size: 1.1rem;
                width: 100%; /* Full width links */
            }
            nav a:last-child {
                border-bottom: none;
            }

            /* Adjust search bar for mobile */
            .search-bar {
                flex: 1; /* Allow it to grow */
                max-width: none; /* Remove max-width constraint */
                order: 2; /* Place in the middle */
                position: static; /* Remove absolute positioning if it was there */
                margin: 0 10px; /* Add some margin */
                display: flex; /* Ensure it's a flex container */
                align-items: center;
                border: 1px solid #ddd; /* Add border to the whole bar */
                border-radius: 999px; /* Rounded corners for the bar */
                background: #f9f9f9; /* Light background for the input area */
            }
            .search-bar input {
                display: block; /* Show input field on mobile */
                flex: 1;
                padding: 0.5rem 1rem;
                border: none; /* Remove individual input border */
                border-radius: 999px; /* Rounded corners for input */
                font-size: 1rem;
                background: transparent; /* Transparent background */
            }
            /* Hide desktop search button */
            #desktopSearchBtn {
                display: none;
            }
            /* Show mobile search icon inside the bar */
            #mobileSearchIconInBar {
                display: block; /* Show on mobile */
                background: none;
                border: none;
                padding: 0.5rem;
                cursor: pointer;
            }
            #mobileSearchIconInBar svg {
                fill: #333;
                width: 24px;
                height: 24px;
            }

            /* Buttons on the right */
            .header-right {
                order: 3; /* Place last */
                gap: 0.5rem; /* Smaller gap */
            }
            .btn-rounded {
                padding: 0.3rem 0.8rem; /* Smaller padding */
                font-size: 0.8rem; /* Smaller font */
            }
            .btn-rounded svg {
                width: 18px; /* Smaller icons */
                height: 18px;
            }
            /* Reduce button text for smaller screens */
            .btn-rounded span {
                display: none; /* Hide text on small screen */
            }
            /* Only show icon for account and cart buttons on very small screens */
            @media (max-width: 480px) {
                .btn-rounded span {
                    display: none;
                }
                .btn-rounded {
                    padding: 0.5rem; /* Make it square */
                    border-radius: 50%; /* Make it circular */
                }
            }

            /* Adjust dropdown for search results */
            .dropdown {
                width: 100%; /* Take full width on mobile */
                left: 0;
                right: auto; /* Clear right positioning */
                margin-top: 0.5rem; /* Space below header */
                border-radius: 0; /* No rounded corners */
                top: 55px; /* Position below header */
            }

            /* Adjust container padding for mobile */
            .container {
                padding: 0 1rem;
            }

            /* Products grid on mobile (two columns) */
            .products {
                grid-template-columns: repeat(auto-fill, minmax(150px,1fr)); /* Adjusted for two columns, min width for small screens */
                gap: 1rem; /* Smaller gap for mobile */
            }
            @media (max-width: 480px) { /* For very small screens, go back to 1 column */
                .products {
                    grid-template-columns: 1fr;
                }
            }

            /* Show bottom navigation bar */
            .bottom-nav {
                display: flex; /* Show on mobile */
            }
            /* Add padding to the body to prevent content from being hidden by the bottom nav */
            body {
                padding-bottom: 60px; /* Height of bottom nav */
            }
            /* Hide the desktop footer on mobile if bottom nav is present */
            footer {
                display: none;
            }
        }

        /* Rest of your existing CSS (not directly affected by mobile header changes) */
        /* DROPDOWN DE BÚSQUEDA */
        .dropdown {
            position: absolute;
            top: 100%; left: 0; right: 0;
            background: #fff;
            border: 1px solid #ccc;
            border-top: none;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            display: none;
            font-size: 0.9rem;
            border-radius: 0 0 4px 4px;
        }
        .dropdown .heading {
            padding: 0.5rem 1rem;
            font-weight: bold;
            background: #f9f9f9;
            border-bottom: 1px solid #eee;
            color: #000000;
            font-size: 1.1rem;
        }
        .dropdown .item.history {
            padding: 0.5rem 1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #a437ec;
            font-weight: normal;
        }
        .dropdown .item.history:hover {
            background: #f0f0f0;
        }
        .dropdown .item .delete {
            margin-left: 1rem;
            cursor: pointer;
            font-weight: bold;
            color: #000000;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .dropdown .item .delete:hover {
            opacity: 1;
        }
        .dropdown .item.suggestion {
            padding: 1rem 1.5rem;
            font-size: 0.9rem;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .dropdown .item.suggestion:hover {
            background: #f0f0f0;
        }
        .suggestion-arrow {
            width: 16px;
            height: 16px;
            fill: #999;
            transform: rotate(-45deg);
            margin-left: 10px;
            transition: fill 0.2s, transform 0.2s;
        }
        .dropdown .item.suggestion:hover .suggestion-arrow {
            fill: #ff0101;
            transform: rotate(-45deg) scale(1.1);
        }
        .search-suggestion-icon {
            width: 16px;
            height: 16px;
            fill: #999;
        }

        /* --- ESTILOS DEL MENÚ DE CUENTA DESPLEGABLE --- */
        .user-menu-container {
            position: relative;
            display: inline-block;
        }
        .account-dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 20;
            border-radius: 5px;
            right: 0;
            top: calc(100% + 5px);
        }
        .account-dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            text-align: left;
            transition: background-color 0.2s ease;
        }
        .account-dropdown-content a:hover {
            background-color: #f1f1f1;
        }
        .account-dropdown-content a:first-child {
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }
        .account-dropdown-content a:last-child {
            border-bottom-left-radius: 5px;
            border-bottom-right-radius: 5px;
        }
        .account-dropdown-content.show {
            display: block;
        }

        /* Select idioma */
        #lang-select {
            background: white;
            color: #e60000;
            border: 2px solid #e60000;
            border-radius: 999px;
            padding: 0.3rem 0.8rem;
            font-weight: 700;
            cursor: pointer;
            font-size: 0.9rem;
            outline: none;
            transition: background 0.2s, color 0.2s;
        }
        #lang-select:hover {
            background: #ffe6e6;
        }

        /* CONTENIDO */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        .products {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px,1fr));
            gap: 2rem;
        }
        .product {
            position: relative;
            background: #fff;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .product:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .promo-label {
            position: absolute;
            top: 12px; left: 12px;
            background: #e60000;
            color: #fff;
            padding: 0.3rem 0.6rem;
            font-size: 0.75rem;
            font-weight: 700;
            border-radius: 3px;
            text-transform: uppercase;
        }
        .product img {
            width: 100%;
            border-radius: 4px;
            margin-bottom: 1rem;
        }
        .product h3 { margin-bottom: 0.5rem; }
        .product p {
            margin-bottom: 1rem;
            font-weight: 600;
        }
        .product button {
            padding: 0.6rem 1.2rem;
            border: none;
            background: #000000;
            color: #fff;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        .product button:hover {
            background: #b30000;
        }

        /* FOOTER */
        footer {
            text-align: center;
            padding: 2rem;
            background: #fff;
            margin-top: 4rem;
            font-size: 0.9rem;
        }

        /* Nuevo carrito lateral */
        #cajita-carrito {
            position: fixed;
            top: 0;
            right: -100%;
            width: 380px;
            height: 100vh;
            background: white;
            box-shadow: -6px 0 20px rgb(0 0 0 / 0.1);
            padding: 25px 20px 40px;
            box-sizing: border-box;
            transition: right 0.35s ease;
            z-index: 1000;
        }
        #cajita-carrito header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding: 0;
            background: none;
            box-shadow: none;
        }
        #cerrarCarrito {
            font-size: 24px;
            background: none;
            border: none;
            cursor: pointer;
        }

        /* Estilos para los elementos del carrito */
        .item-carrito {
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
            margin-bottom: 15px;
            transition: opacity 0.3s ease;
        }
        .item-carrito:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        /* Bottom Navigation Bar */
        .bottom-nav {
            display: none; /* Hidden by default on desktop */
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #fff;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.05);
            z-index: 100;
            justify-content: space-around;
            align-items: center;
            padding: 0.5rem 0;
        }

        .bottom-nav .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #666;
            font-size: 0.75rem;
            flex: 1;
            padding: 0.3rem 0;
            transition: color 0.2s;
        }

        .bottom-nav .nav-item svg {
            width: 24px;
            height: 24px;
            margin-bottom: 3px;
            fill: #666;
            transition: fill 0.2s;
        }

        .bottom-nav .nav-item.active,
        .bottom-nav .nav-item:hover {
            color: #ff0101;
        }

        .bottom-nav .nav-item.active svg,
        .bottom-nav .nav-item:hover svg {
            fill: #ff0101;
        }
    </style>
</head>
<body>

    <header>
        <button class="hamburger-menu-btn" aria-label="Abrir menú" tabindex="0">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
            </svg>
        </button>

        <img src="https://i.imgur.com/pdZ8WNX.png" alt="FlashBuyX Logo" style="cursor: pointer;" onclick="location.reload()" tabindex="0">

        <nav>
            <a onclick="location.reload()" tabindex="0">Inicio</a>
            <a href="#" tabindex="0">Productos</a>
            <a href="#" tabindex="0">Ofertas</a>
            <a href="#" tabindex="0">Contacto</a>
        </nav>
        <div class="search-bar">
            <input id="searchInput" type="text" placeholder="Buscar productos…" autocomplete="off" />
            
            <button id="desktopSearchBtn" aria-label="Buscar">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="#fff" viewBox="0 0 24 24">
                    <circle cx="10" cy="10" r="6" stroke="#fff" stroke-width="2" fill="none"/>
                    <line x1="14" y1="14" x2="20" y2="20" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
            
            <button id="mobileSearchIconInBar" aria-label="Buscar">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#333" viewBox="0 0 24 24">
                    <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                </svg>
            </button>
            <div id="dropdown" class="dropdown"></div>
        </div>

        <div id="headerRightButtons" class="header-right">

            <a id="loginRegisterButton" href="Login.html" class="btn-rounded" tabindex="0">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
                <span>Cuenta</span>
            </a>

            <div id="userMenuContainer" class="user-menu-container" style="display:none;">
                <button id="userNameButton" class="btn-rounded" tabindex="0">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                    <span></span>
                </button>
                <div id="userDropdown" class="account-dropdown-content">
                    <a href="configuracion.html" tabindex="0">Configuración</a>
                    <a href="#" id="logoutButton" tabindex="0">Cerrar Sesión</a>
                </div>
            </div>

            <a id="abrirCarrito" class="btn-rounded" tabindex="0">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm10
                    0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM7.2 14l.9-2h7.5
                    c.8 0 1.5-.5 1.8-1.3l2.5-6.1c.1-.2.1-.4.1-.6 0-.6-.4-1-1-1H5.2
                    L4.3 2H1v2h2l3.6 7.6-1.4 2.4C5 14.2 5.8 15 6.7 15h12v-2H7.2z"/>
                </svg>
                <span>Carrito</span>
            </a>
        </div>
    </header>

    <aside id="cajita-carrito">
        <header>
            <h2>Tu carrito</h2>
            <button id="cerrarCarrito" tabindex="0">&times;</button>
        </header>
        <div id="contenidoCarrito"><p style="text-align:center; color:#666; font-style:italic; margin-top:20px;">Tu carrito está vacío.</p></div>
    </aside>

    <div class="container" style="margin-top: 5rem;">
        <section class="products" id="productsContainer">
            <div class="product"><div class="promo-label">¡Oferta!</div><img src="https://via.placeholder.com/300/FF5733/FFFFFF?text=Producto+1" alt="Producto 1"><h3>Producto 1</h3><p>$19.99</p><button tabindex="0">Añadir al carrito</button></div>
            <div class="product"><div class="promo-label">¡Oferta!</div><img src="https://via.placeholder.com/300/33FF57/FFFFFF?text=Producto+2" alt="Producto 2"><h3>Producto 2</h3><p>$29.99</p><button tabindex="0">Añadir al carrito</button></div>
            <div class="product"><div class="promo-label">¡Oferta!</div><img src="https://via.placeholder.com/300/3357FF/FFFFFF?text=Audífonos+Bluetooth" alt="Audífonos Bluetooth"><h3>Audífonos Bluetooth</h3><p>$49.99</p><button tabindex="0">Añadir al carrito</button></div>
            <div class="product"><div class="promo-label">¡Oferta!</div><img src="https://via.placeholder.com/300/FF33DA/FFFFFF?text=Smartwatch+X" alt="Smartwatch X"><h3>Smartwatch X</h3><p>$99.99</p><button tabindex="0">Añadir al carrito</button></div>
            <div class="product"><div class="promo-label">¡Oferta!</div><img src="https://via.placeholder.com/300/DA33FF/FFFFFF?text=Tablet+Pro" alt="Tablet Pro"><h3>Tablet Pro</h3><p>$199.99</p><button tabindex="0">Añadir al carrito</button></div>
            <div class="product"><div class="promo-label">¡Oferta!</div><img src="https://via.placeholder.com/300/33FFFF/FFFFFF?text=Auriculares+Noise+Cancelling" alt="Auriculares Noise Cancelling"><h3>Auriculares Noise Cancelling</h3><p>$79.99</p><button tabindex="0">Añadir al carrito</button></div>
        </section>
    </div>

    <footer>© 2025 FlashBuyX. Todos los derechos reservados.</footer>

    <nav class="bottom-nav">
        <a href="#" class="nav-item active">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            <span>Inicio</span>
        </a>
        <a href="#" class="nav-item">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
            <span>Buscar</span>
        </a>
        <a href="Login.html" class="nav-item">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
            <span>Cuenta</span>
        </a>
        <a href="#" id="bottomCartBtn" class="nav-item">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM7.2 14l.9-2h7.5c.8 0 1.5-.5 1.8-1.3l2.5-6.1c.1-.2.1-.4.1-.6 0-.6-.4-1-1-1H5.2L4.3 2H1v2h2l3.6 7.6-1.4 2.4C5 14.2 5.8 15 6.7 15h12v-2H7.2z"/></svg>
            <span>Carrito</span>
        </a>
    </nav>

    <script>
        const productos = Array.from(document.querySelectorAll('.product')).map(p => p.querySelector('h3').textContent);
        const input = document.getElementById('searchInput');
        const dd = document.getElementById('dropdown');

        let usuarioActivo = null;
        let carrito = {};

        const loginRegisterButton = document.getElementById('loginRegisterButton');
        const userMenuContainer = document.getElementById('userMenuContainer');
        const userNameButton = document.getElementById('userNameButton');
        const userDropdown = document.getElementById('userDropdown');
        const logoutButton = document.getElementById('logoutButton');

        const btnAbrirCarrito = document.getElementById('abrirCarrito');
        const cajitaCarrito = document.getElementById('cajita-carrito');
        const btnCerrarCarrito = document.getElementById('cerrarCarrito');

        const hamburgerBtn = document.querySelector('.hamburger-menu-btn');
        const mainNav = document.querySelector('nav');
        const desktopSearchBtn = document.getElementById('desktopSearchBtn');
        const mobileSearchIconInBar = document.getElementById('mobileSearchIconInBar');
        const bottomCartBtn = document.getElementById('bottomCartBtn');


        // --- Functions for Hamburger Menu ---
        hamburgerBtn.addEventListener('click', () => {
            mainNav.classList.toggle('active');
            // Close other open menus
            userDropdown.classList.remove('show');
            cajitaCarrito.style.right = '-100%';
        });

        // Close hamburger menu when a link is clicked
        mainNav.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                mainNav.classList.remove('active');
            });
        });

        // Close hamburger menu when clicking outside
        document.addEventListener('click', (event) => {
            if (!mainNav.contains(event.target) && !hamburgerBtn.contains(event.target)) {
                mainNav.classList.remove('active');
            }
        });


        // --- Funciones para Historial de Búsqueda ---
        function getHistorial() {
            const key = usuarioActivo ? `historial_${usuarioActivo}` : 'historial_anonimo';
            return JSON.parse(localStorage.getItem(key)) || [];
        }

        function saveHistorial(term) {
            if (!term) return;
            const key = usuarioActivo ? `historial_${usuarioActivo}` : 'historial_anonimo';
            let h = getHistorial();
            if (!h.includes(term)) {
                h.unshift(term);
                if (h.length > 10) h.pop();
                localStorage.setItem(key, JSON.stringify(h));
            }
        }

        function deleteHistorial(term) {
            const key = usuarioActivo ? `historial_${usuarioActivo}` : 'historial_anonimo';
            let h = getHistorial().filter(t => t !== term);
            localStorage.setItem(key, JSON.stringify(h));
            return h;
        }

        function renderDropdown(list, heading) {
            if (!list.length) {
                dd.style.display = 'none';
                return;
            }
            dd.innerHTML = `<div class="heading">${heading}</div>` + list.map(item => {
                if (heading === 'Historial') {
                    return `<div class="item history" tabindex="0">${item}<span class="delete" data-term="${item}">✕</span></div>`;
                } else {
                    return `<div class="item suggestion" tabindex="0">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <svg viewBox="0 0 24 24" class="search-suggestion-icon"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                                    <span>${item}</span>
                                </div>
                                <svg viewBox="0 0 24 24" class="suggestion-arrow">
                                    <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/>
                                </svg>
                            </div>`;
                }
            }).join('');
            dd.style.display = 'block';

            dd.querySelectorAll('.item').forEach(el => {
                el.onclick = e => {
                    if (e.target.classList.contains('delete')) {
                        const restante = deleteHistorial(e.target.dataset.term);
                        if (restante.length === 0) {
                            dd.style.display = 'none';
                            input.value = '';
                        } else {
                            renderDropdown(restante, 'Historial');
                        }
                    } else {
                        const textContentElement = el.querySelector('.item.suggestion span') || el.firstChild;
                        input.value = textContentElement.textContent.trim().replace(/✕$/, '');
                        filtrar(input.value.toLowerCase());
                        saveHistorial(input.value);
                        dd.style.display = 'none';
                    }
                };
            });
        }

        function filtrar(term) {
            document.querySelectorAll('.product').forEach(p => {
                const name = p.querySelector('h3').textContent.toLowerCase();
                p.style.display = name.includes(term) ? 'block' : 'none';
            });
        }

        // Eventos para la barra de búsqueda
        input.addEventListener('focus', () => {
            renderDropdown(getHistorial(), 'Historial');
            // Close other open menus
            mainNav.classList.remove('active');
            userDropdown.classList.remove('show');
            cajitaCarrito.style.right = '-100%';
        });
        input.addEventListener('input', () => {
            const term = input.value.trim().toLowerCase();
            if (term) {
                const sugerencias = productos.filter(p => p.toLowerCase().includes(term));
                renderDropdown(sugerencias, 'Sugerencias');
            } else {
                renderDropdown(getHistorial(), 'Historial');
            }
        });

        document.addEventListener('click', e => {
            if (!e.target.closest('.search-bar')) {
                dd.style.display = 'none';
            }
        });

        function buscar() {
            const term = input.value.trim();
            if (!term) return;
            saveHistorial(term);
            filtrar(term.toLowerCase());
            dd.style.display = 'none';
            input.blur();
        }
        // Desktop search button event listener
        desktopSearchBtn.addEventListener('click', e => {
            e.preventDefault();
            buscar();
        });
        // Mobile search icon event listener
        mobileSearchIconInBar.addEventListener('click', e => {
            e.preventDefault();
            buscar();
        });
        input.addEventListener('keydown', e => {
            if (e.key === 'Enter') {
                e.preventDefault();
                buscar();
            }
        });

        // --- Funciones para Carrito por Usuario (o Anónimo) ---
        function guardarCarrito() {
            const key = usuarioActivo ? `carrito_${usuarioActivo}` : 'carrito_anonimo';
            localStorage.setItem(key, JSON.stringify(carrito));
        }

        function cargarCarrito() {
            const key = usuarioActivo ? `carrito_${usuarioActivo}` : 'carrito_anonimo';
            const carritoGuardado = localStorage.getItem(key);
            if (carritoGuardado) {
                carrito = JSON.parse(carritoGuardado);
            } else {
                carrito = {};
            }
            renderizarCarrito();
        }

        function renderizarCarrito() {
            const contenidoCarrito = document.getElementById('contenidoCarrito');
            contenidoCarrito.innerHTML = '';

            const keys = Object.keys(carrito);
            if (keys.length === 0) {
                contenidoCarrito.innerHTML = '<p style="text-align:center; color:#666; font-style:italic; margin-top:20px;">Tu carrito está vacío.</p>';
                return;
            }

            keys.forEach(nombre => {
                const item = carrito[nombre];
                const div = document.createElement('div');
                div.className = 'item-carrito';
                div.dataset.nombre = nombre;
                div.style.display = 'flex';
                div.style.alignItems = 'center';
                div.style.marginBottom = '15px';

                div.innerHTML = `
                    <img src="${item.imgSrc}" alt="${nombre}" width="50" height="50" style="border-radius:5px; margin-right: 10px;">
                    <div style="flex-grow:1; display:flex; flex-direction: column;">
                        <strong style="margin-bottom: 6px;">${nombre}</strong>
                        <div style="display:flex; justify-content: space-between; align-items: center;">
                            <div>Precio: <span class="precio-total">$${(item.precioUnitario * item.cantidad).toFixed(2)}</span></div>
                            <button class="eliminar" style="background:#e60000; color:white; border:none; border-radius:4px; padding: 4px 10px; cursor:pointer; font-weight:bold; font-size: 0.85rem;" tabindex="0">ELIMINAR</button>
                        </div>
                        <div style="margin-top: 6px; display:flex; align-items: center; gap: 8px;">
                            Cantidad:
                            <button class="menos" style="cursor:pointer; font-size: 16px; padding: 3px 8px; border-radius: 5px; border: 1px solid #ccc; background: #f0f0f0; box-shadow: 1px 1px 3px rgba(0,0,0,0.1);" tabindex="0">-</button>
                            <span class="cantidad" style="min-width: 18px; text-align: center;">${item.cantidad}</span>
                            <button class="mas" style="cursor:pointer; font-size: 16px; padding: 3px 8px; border-radius: 5px; border: 1px solid #ccc; background: #f0f0f0; box-shadow: 1px 1px 3px rgba(0,0,0,0.1);" tabindex="0">+</button>
                        </div>
                    </div>
                `;

                div.querySelector('.eliminar').addEventListener('click', () => {
                    div.style.opacity = '0';
                    setTimeout(() => {
                        delete carrito[nombre];
                        guardarCarrito();
                        renderizarCarrito();
                    }, 300);
                });

                div.querySelector('.menos').addEventListener('click', () => {
                    if (item.cantidad > 1) {
                        item.cantidad--;
                        guardarCarrito();
                        renderizarCarrito();
                    } else {
                        div.style.opacity = '0';
                        setTimeout(() => {
                            delete carrito[nombre];
                            guardarCarrito();
                            renderizarCarrito();
                        }, 300);
                    }
                });

                div.querySelector('.mas').addEventListener('click', () => {
                    item.cantidad++;
                    guardarCarrito();
                    renderizarCarrito();
                });

                contenidoCarrito.appendChild(div);
            });
        }

        // --- Lógica de añadir producto al carrito (ahora sin necesidad de login) ---
        document.querySelectorAll('.product button').forEach(btn => {
            btn.addEventListener('click', () => {
                const productDiv = btn.closest('.product');
                const nombre = productDiv.querySelector('h3').textContent;
                const precioTexto = productDiv.querySelector('p').textContent;
                const imgSrc = productDiv.querySelector('img').src;
                const precioUnitario = parseFloat(precioTexto.replace(/[^0-9.,]/g, '').replace(',', '.'));

                if (carrito[nombre]) {
                    carrito[nombre].cantidad++;
                } else {
                    carrito[nombre] = {
                        precioUnitario,
                        cantidad: 1,
                        imgSrc
                    };
                }

                guardarCarrito();
                renderizarCarrito();

                const cajita = document.getElementById('cajita-carrito');
                cajita.style.right = '0';
                userDropdown.classList.remove('show');
                mainNav.classList.remove('active'); // Close hamburger menu
            });
        });

        // --- Carrito lateral toggle ---
        btnAbrirCarrito.addEventListener('click', () => {
            cajitaCarrito.style.right = '0';
            // Close other open menus
            userDropdown.classList.remove('show');
            mainNav.classList.remove('active');
        });

        btnCerrarCarrito.addEventListener('click', () => {
            cajitaCarrito.style.right = '-100%';
        });

        // Bottom nav cart button
        bottomCartBtn.addEventListener('click', () => {
            cajitaCarrito.style.right = '0';
            userDropdown.classList.remove('show');
            mainNav.classList.remove('active');
        });

        // --- Manejo de la interfaz de cuenta (el nuevo comportamiento dinámico) ---
        function updateAccountButton() {
            const sesionData = JSON.parse(localStorage.getItem('sesionIniciada'));

            if (sesionData && sesionData.nombre) {
                loginRegisterButton.style.display = 'none';
                userMenuContainer.style.display = 'inline-block';
                userNameButton.innerHTML = `
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                    <span>${sesionData.nombre}</span>
                `;
            } else {
                loginRegisterButton.style.display = 'inline-block';
                userMenuContainer.style.display = 'none';
            }
        }

        userNameButton.addEventListener('click', () => {
            userDropdown.classList.toggle('show');
            // Close other open menus
            mainNav.classList.remove('active');
            cajitaCarrito.style.right = '-100%';
        });

        logoutButton.addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.removeItem('sesionIniciada');
            localStorage.removeItem('usuarioActivo');
            usuarioActivo = null; // Reset current active user
            carrito = {}; // Clear cart for logged out user
            guardarCarrito(); // Save empty cart
            renderizarCarrito(); // Update cart display
            updateAccountButton(); // Update account button state
            userDropdown.classList.remove('show');
            window.location.href = 'Login.html'; // Redirect to login page
        });

        // Close dropdown if clicked outside
        document.addEventListener('click', (event) => {
            if (!userMenuContainer.contains(event.target) && !userDropdown.contains(event.target)) {
                userDropdown.classList.remove('show');
            }
        });

        // Mejoras de accesibilidad con teclado
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                mainNav.classList.remove('active');
                userDropdown.classList.remove('show');
                cajitaCarrito.style.right = '-100%';
            }

            if (event.key === 'Enter') {
                const activeElement = document.activeElement;

                // Handle Enter on hamburger menu button
                if (activeElement === hamburgerBtn) {
                    activeElement.click();
                    event.preventDefault();
                }

                // Handle Enter on account button
                if (activeElement === userNameButton) {
                    activeElement.click();
                    event.preventDefault();
                }

                // Handle Enter on account dropdown links
                if (activeElement && activeElement.parentElement === userDropdown && activeElement.tagName === 'A' && activeElement.hasAttribute('tabindex')) {
                    activeElement.click();
                    event.preventDefault();
                }

                // Handle Enter on FlashBuyX Logo to reload page
                if (activeElement && activeElement.tagName === 'IMG' && activeElement.alt === 'FlashBuyX Logo' && activeElement.hasAttribute('tabindex')) {
                    activeElement.click(); 
                    event.preventDefault();
                }

                // Handle Enter on search dropdown items (suggestions and history)
                if (activeElement && activeElement.classList.contains('item') && activeElement.hasAttribute('tabindex')) {
                    activeElement.click();
                    event.preventDefault();
                }
            }
        });

        // --- Inicializar al cargar la página ---
        window.onload = () => {
            const sesionData = JSON.parse(localStorage.getItem('sesionIniciada'));
            const usuarioActivoLS = localStorage.getItem('usuarioActivo'); 

            if (sesionData && sesionData.nombre) {
                usuarioActivo = sesionData.nombre;
            } else {
                usuarioActivo = null; 
            }
            
            updateAccountButton(); 
            cargarCarrito(); 
        };

        // Escucha el evento 'storage' para reaccionar a cambios en localStorage desde Login.html
        window.addEventListener('storage', (event) => {
            if (event.key === 'sesionIniciada' || event.key === 'usuarioActivo') {
                updateAccountButton();
                cargarCarrito(); 
            }
        });

    </script>
</body>
</html>